import{c as q,u as V,r as l,j as t,T as _}from"./index-CTwsE_AD.js";import{E as Q,c as z,l as m,s as u,R as J,U as X,C as Z,a as ee,r as te,p as se}from"./rosterParser-DYNnO0C5.js";import{N as ae,A as L,a as T,E as U,b as B}from"./Navbar-YnhaArQD.js";/* empty css            */import{C as re,B as S,T as P,a as N}from"./TextField-BpGWHAT7.js";import{A as oe}from"./Autocomplete-C3Uz2P6w.js";const ne=async({units:y,commandPoints:x,roundPoints:h,paintedBonus:i,gameDate:j,customFileName:d,playerName:f,playerFaction:c})=>{const s=new Q,o=20;let a=o;const p=new Date(j).toLocaleDateString("en-GB");s.setFontSize(20),d?(s.text(d,o,a),a+=10,s.setFontSize(14),s.text(`Game Date: ${p}`,o,a),a+=20):(s.setFontSize(14),s.text(`Game Date: ${p}`,o,a),a+=20);const D=30,C=30;if(c!=null&&c.icon)try{const n=await ie(c.icon);s.addImage(n,"PNG",o,a,D,C),s.setFontSize(20),s.text(f,o+D+5,a+20)}catch(n){console.error("Error loading faction icon:",n),s.setFontSize(20),s.text(f,o,a+20)}else f&&(s.setFontSize(20),s.text(f,o,a+20));a+=40;const b=[["Round","Victory Points"],...h.map((n,g)=>[`Round ${g+1}`,n]),["Painted Bonus",i?10:0],["Command Points Remaining",x],["Total Score",z(h,i)]];s.autoTable({startY:a,head:[b[0]],body:b.slice(1),styles:{fontSize:12,cellPadding:8,halign:"center"},headStyles:{fillColor:[66,66,66],textColor:[255,255,255]},alternateRowStyles:{fillColor:[240,240,240]},columnStyles:{0:{fontStyle:"bold"}}}),y.length>0&&(s.addPage(),a=o,s.setFontSize(16),s.text("Army Roster",o,a),a+=10,s.autoTable({startY:a,head:[["Unit Name","Points","Kills","Status","Agenda"]],body:y.map(n=>[n.name,n.points,n.kills,n.destroyed?"Destroyed":"Active",n.agenda?`${n.agenda}${n.agendaCompleted?" (Completed)":""}`:"-"]),styles:{fontSize:10,cellPadding:5,overflow:"linebreak"},headStyles:{fillColor:[66,66,66],textColor:[255,255,255]},alternateRowStyles:{fillColor:[240,240,240]},willDrawPage:n=>{s.setFontSize(16),s.text("Army Roster (continued)",o,o)}}));const R=d?`${d}.pdf`:`crusade_report_${p.replace(/\//g,"-")}.pdf`;s.save(R)},ie=y=>new Promise((x,h)=>{const i=new Image;i.crossOrigin="Anonymous",i.onload=()=>x(i),i.onerror=h,i.src=y}),le={"Adepta Sororitas":new URL("/assets/Adepta%20Sororitas-yHiaLakY.png",import.meta.url).href,"Adeptus Astartes":new URL("/assets/Adeptus%20Astartes-DmCHPDqx.png",import.meta.url).href,"Adeptus Custodes":new URL("/assets/Adeptus%20Custodes-BzTTD9oK.png",import.meta.url).href,"Adeptus Mechanicus":new URL("/assets/Adeptus%20Mechanicus-DHnza-51.png",import.meta.url).href,"Astra Militarum":new URL("/assets/Astra%20Militarum-DdHmbm94.png",import.meta.url).href,"Black Templars":new URL("/assets/Black%20Templars-DHgsc1yf.png",import.meta.url).href,"Blood Angels":new URL("/assets/Blood%20Angels-C_0b1uFM.png",import.meta.url).href,"Dark Angels":new URL("/assets/Dark%20Angels-MHg-JEQm.png",import.meta.url).href,"Leagues of Votann":new URL("/assets/Leagues%20of%20Votann-BBs6GOcY.png",import.meta.url).href,"Space Wolves":new URL("/assets/Space%20Wolves-tbM6qvGJ.png",import.meta.url).href},ce={"Alpha Legion":new URL("/assets/Alpha%20Legion-CIge7ZkT.png",import.meta.url).href,"Chaos Daemons":new URL("/assets/Chaos%20Daemons-CApqTT5s.png",import.meta.url).href,"Death Guard":new URL("/assets/Death%20Guard-DvzNWpOY.png",import.meta.url).href,Khorne:new URL("/assets/Khorne-CMAzh2kt.png",import.meta.url).href,Nurgle:new URL("/assets/Nurgle-BEkw7Q7u.png",import.meta.url).href,Slaanesh:new URL("/assets/Slaanesh-Wybfl6eD.png",import.meta.url).href,"Thousand Sons":new URL("/assets/Thousand%20Sons-CvCkbwjS.png",import.meta.url).href,"World Bearers":new URL("/assets/World%20Bearers-DyORQbUc.png",import.meta.url).href,"World Eaters":new URL("/assets/World%20Eaters-CBSKqlo-.png",import.meta.url).href},de={Aeldari:new URL("/assets/Aeldari-MtTb0xIA.png",import.meta.url).href,Drukhari:new URL("/assets/Drukhari-kCUM2K6H.png",import.meta.url).href,"Genestealer Cults":new URL("/assets/Genestealer%20Cults-CynBgc42.png",import.meta.url).href,Necrons:new URL("/assets/Necrons-fTRcgW_S.png",import.meta.url).href,Orks:new URL("/assets/Orks-4XaAq8j4.png",import.meta.url).href,Tau:new URL("/assets/Tau-CKDRBT2o.png",import.meta.url).href,Tyranids:new URL("/assets/Tyranids-Dryw1-5z.png",import.meta.url).href},pe={Imperium:le,Chaos:ce,Xenos:de},me=q({palette:{mode:"dark"}}),ye=()=>{const y=V(),[x,h]=l.useState(["roster","cp","vp"]),[i,j]=l.useState(m("units")||[]),[d,f]=l.useState(m("commandPoints")||0),[c,s]=l.useState(m("rosterText")||""),[o,a]=l.useState(m("roundPoints")||Array(5).fill(0)),[p,D]=l.useState(m("paintedBonus")||!1),[C,b]=l.useState(m("gameDate")||new Date().toISOString().split("T")[0]),[R,n]=l.useState(m("customFileName")||""),[g,k]=l.useState(m("playerName")||""),[w,I]=l.useState(m("playerFaction")||""),[E,O]=l.useState(!0);l.useEffect(()=>{u("units",i),u("commandPoints",d),u("rosterText",c),u("roundPoints",o),u("paintedBonus",p),u("gameDate",C),u("customFileName",R),u("playerName",g),u("playerFaction",w)},[i,d,c,o,p,C,R,g,w]);const W=(e,r,v)=>{j(M=>M.map(A=>A.id===e?{...A,[r]:v}:A))},G=()=>{ne({units:i,commandPoints:d,roundPoints:o,paintedBonus:p,gameDate:C,customFileName:R,playerName:g,playerFaction:w})},H=()=>{y("/",{state:{playerMode:"1"}})},F=()=>{window.confirm("Are you sure you want to reset all data?")&&te({setUnits:j,setCommandPoints:f,setRosterText:s,setRoundPoints:a,setPaintedBonus:D,setGameDate:b,setCustomFileName:n,setPlayerName:k,setPlayerFaction:I})},K=e=>{k(e.target.value)},Y=()=>{const e=[];return Object.entries(pe).forEach(([r,v])=>{Object.entries(v).forEach(([M,A])=>{e.push({category:r,name:M,icon:A})})}),e},$=()=>{console.log("Parsing roster text:",c);try{const e=se(c);console.log("Parsed units:",e),j(e)}catch(e){console.error("Error parsing roster:",e),alert("Error parsing roster. Please check the console for details.")}};return t.jsx(_,{theme:me,children:t.jsxs(re,{maxWidth:"md",sx:{paddingTop:{xs:"48px",sm:"64px"},paddingBottom:"20px",paddingLeft:{xs:"8px",sm:"24px"},paddingRight:{xs:"8px",sm:"24px"}},children:[t.jsx(ae,{onExportPDF:G,onNavigateHome:H,onReset:F,context:"singlePlayer",currentPage:"App",sx:{"& .MuiButton-root":{borderRadius:"4px",transition:"all 0.3s ease",textTransform:"none","&.MuiButton-containedPrimary":{background:"linear-gradient(45deg, #2196F3 30%, #21CBF3 90%)","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(33, 203, 243, 0.3)"}},"&.MuiButton-containedSecondary":{background:"linear-gradient(45deg, #7b1fa2 30%, #9c27b0 90%)","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(156, 39, 176, 0.3)"}}}}}),t.jsxs(S,{className:"scrollable-container",children:[t.jsxs(L,{expanded:E,onChange:()=>O(!E),children:[t.jsx(T,{expandIcon:t.jsx(U,{}),"aria-controls":"player-info-content",id:"player-info-header",children:t.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(P,{variant:"h6",children:g||"Player Information"}),w&&t.jsx("img",{src:w.icon,alt:w.name,style:{width:"80px",height:"80px"}})]})}),t.jsx(B,{children:t.jsxs(S,{sx:{display:"flex",flexDirection:"column",gap:2},children:[t.jsx(N,{label:"Player Name",value:g,onChange:K,fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"white"},"&:hover fieldset":{borderColor:"#90caf9"},"&.Mui-focused fieldset":{borderColor:"#90caf9"}},"& .MuiInputLabel-root":{color:"white"}}}),t.jsx(oe,{value:w,onChange:(e,r)=>{I(r)},options:Y(),groupBy:e=>e.category,getOptionLabel:e=>(e==null?void 0:e.name)||"",isOptionEqualToValue:(e,r)=>(e==null?void 0:e.name)===(r==null?void 0:r.name),renderOption:(e,r)=>t.jsx(S,{component:"li",...e,children:t.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx("img",{src:r.icon,alt:r.name,style:{width:"80px",height:"80px"}}),r.name]})}),renderInput:e=>t.jsx(N,{...e,label:"Faction",sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"white"},"&:hover fieldset":{borderColor:"#90caf9"},"&.Mui-focused fieldset":{borderColor:"#90caf9"}},"& .MuiInputLabel-root":{color:"white"}}}),sx:{"& .MuiAutocomplete-groupLabel":{color:"#90caf9",fontWeight:"bold"},"& .MuiAutocomplete-paper":{backgroundColor:"#424242"},"& .MuiAutocomplete-option":{color:"white"}}})]})})]}),t.jsxs(L,{expanded:x.includes("roster"),onChange:()=>h(e=>e.includes("roster")?e.filter(r=>r!=="roster"):[...e,"roster"]),children:[t.jsx(T,{expandIcon:t.jsx(U,{}),"aria-controls":"roster-content",id:"roster-header",children:t.jsx(P,{variant:"h6",children:"Roster"})}),t.jsxs(B,{children:[t.jsx(J,{rosterText:c,setRosterText:s,gameDate:C,setGameDate:b,customFileName:R,setCustomFileName:n,parseRoster:$,resetData:F}),t.jsx(X,{units:i,updateUnit:W})]})]}),t.jsxs(L,{expanded:x.includes("cp"),onChange:()=>h(e=>e.includes("cp")?e.filter(r=>r!=="cp"):[...e,"cp"]),children:[t.jsx(T,{expandIcon:t.jsx(U,{}),"aria-controls":"cp-content",id:"cp-header",children:t.jsx(P,{variant:"h6",children:"Command Points"})}),t.jsx(B,{children:t.jsx(Z,{commandPoints:d,setCommandPoints:f})})]}),t.jsxs(L,{expanded:x.includes("vp"),onChange:()=>h(e=>e.includes("vp")?e.filter(r=>r!=="vp"):[...e,"vp"]),children:[t.jsx(T,{expandIcon:t.jsx(U,{}),"aria-controls":"vp-content",id:"vp-header",children:t.jsx(P,{variant:"h6",children:"Victory Points"})}),t.jsx(B,{children:t.jsx(ee,{roundPoints:o,setRoundPoints:a,paintedBonus:p,setPaintedBonus:D})})]}),t.jsx(S,{flexGrow:1}),t.jsxs(P,{variant:"h6",align:"center",className:"total-score",gutterBottom:!0,children:["Total Score: ",z(o,p)]})]})]})})};export{ye as default};
