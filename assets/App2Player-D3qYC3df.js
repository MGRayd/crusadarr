import{j as e,c as re,u as le,a as ie,r as m,T as ce}from"./index-B-xIkcL4.js";import{F as de,b as me,E as xe,l as h,s as y,R as ge,U as pe,C as ue,a as he,c as X,p as ye,r as Pe}from"./rosterParser-C9CRvGzc.js";import{B as f,T as I,b as q,a as Se,C as fe}from"./TextField-42mvxB-E.js";import{N as je,A as W,a as G,E as L,b as O}from"./Navbar-5gTV-Sib.js";/* empty css            */const Ce=({commandPoints:l,setCommandPoints:x,customHeading:i})=>{const n=()=>x(l+1),g=()=>{l>0&&x(l-1)};return e.jsxs(f,{className:"command-points",sx:{padding:2,textAlign:"center"},children:[e.jsx(I,{variant:"h5",gutterBottom:!0,children:i}),e.jsx(f,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsxs(f,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(q,{variant:"outlined",onClick:g,sx:{marginRight:1},children:"-"}),e.jsx(I,{variant:"h6",sx:{marginX:1},children:l}),e.jsx(q,{variant:"outlined",onClick:n,children:"+"})]})})]})},Re=({roundPoints:l,setRoundPoints:x,paintedBonus:i,setPaintedBonus:n,customHeading:g})=>{const j=(c,u)=>{const d=[...l];d[c]=u===""?0:Math.max(0,parseInt(u,10)),x(d)};return e.jsxs(f,{id:"rounds-tracking",sx:{padding:2},children:[e.jsx(I,{variant:"h5",gutterBottom:!0,children:g}),l.map((c,u)=>e.jsx(f,{sx:{marginBottom:1},children:e.jsx(Se,{label:`Round ${u+1} Points`,type:"number",value:c===0?"":c,onChange:d=>j(u,d.target.value),size:"small",variant:"outlined",fullWidth:!0,inputProps:{min:0}})},u)),e.jsx(de,{control:e.jsx(me,{checked:i,onChange:c=>n(c.target.checked),color:"primary"}),label:"Painted Bonus"})]})},Q=(l,x)=>{const n=l.reduce((g,j)=>g+j,0)+(x?10:0);return Math.min(n,100)},Te=async({units:l,commandPointsPlayer1:x,commandPointsPlayer2:i,roundPointsPlayer1:n,roundPointsPlayer2:g,paintedBonusPlayer1:j,paintedBonusPlayer2:c,gameDate:u,customFileName:d,player1Name:$,player2Name:C,player1FactionLogo:w,player2FactionLogo:R})=>{const o=new xe,r=20;let a=r;const T=new Date(u).toLocaleDateString("en-GB");o.setFontSize(20),d?(o.text(d,r,a),a+=10,o.setFontSize(14),o.text(`Game Date: ${T}`,r,a),a+=20):(o.setFontSize(14),o.text(`Game Date: ${T}`,r,a),a+=20);const D=o.internal.pageSize.width,p=30,v=30;if(w)try{const t=await Z(w);o.addImage(t,"PNG",r,a,p,v)}catch(t){console.error("Error loading player 1 faction icon:",t)}if(o.setFontSize(20),o.text($,r+p+5,a+20),o.text("VS",D/2,a+15,{align:"center"}),R)try{const t=await Z(R);o.addImage(t,"PNG",D-r-p,a,p,v)}catch(t){console.error("Error loading player 2 faction icon:",t)}o.text(C,D-r-p-o.getTextWidth(C)-5,a+20),a+=40;const F=Q(n,j),B=Q(g,c),P=[["Round",`${$} VP`,`${C} VP`],...n.map((t,S)=>[`Round ${S+1}`,n[S],g[S]]),["Painted Bonus",j?10:0,c?10:0],["Command Points Remaining",x,i],["Total Score",F,B]];o.autoTable({startY:a,head:[P[0]],body:P.slice(1),styles:{fontSize:12,cellPadding:8,halign:"center"},headStyles:{fillColor:[66,66,66],textColor:[255,255,255]},alternateRowStyles:{fillColor:[240,240,240]},columnStyles:{0:{fontStyle:"bold"}},didDrawCell:t=>{if(t.row.index===P.length-2&&t.column.index>0){const S=t.cell.text[0],N=t.column.index===1?B:F;parseInt(S)>parseInt(N)&&(o.setFillColor(63,81,181),o.setTextColor(255,255,255),o.rect(t.cell.x,t.cell.y,t.cell.width,t.cell.height,"F"),o.text(S.toString(),t.cell.x+t.cell.width/2,t.cell.y+t.cell.height/2,{align:"center",baseline:"middle"}))}}}),l.length>0&&(o.addPage(),a=r,o.setFontSize(16),o.text("Army Roster",r,a),a+=10,o.autoTable({startY:a,head:[["Unit Name","Points","Kills","Status","Agenda"]],body:l.map(t=>[t.name,t.points,t.kills,t.destroyed?"Destroyed":"Active",t.agenda?`${t.agenda}${t.agendaCompleted?" (Completed)":""}`:"-"]),styles:{fontSize:10,cellPadding:5,overflow:"linebreak"},headStyles:{fillColor:[66,66,66],textColor:[255,255,255]},alternateRowStyles:{fillColor:[240,240,240]},willDrawPage:t=>{o.setFontSize(16),o.text("Army Roster (continued)",r,r)}}));const k=d?`${d}.pdf`:`crusade_report_${T.replace(/\//g,"-")}.pdf`;o.save(k)},Z=l=>new Promise((x,i)=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>x(n),n.onerror=i,n.src=l}),Fe=re({palette:{mode:"dark"}}),ve=()=>{var M,_,Y,K;const l=le(),x=ie(),[i,n]=m.useState(((M=x.state)==null?void 0:M.player1Name)||localStorage.getItem("player1Name")||"Player 1"),[g,j]=m.useState(((_=x.state)==null?void 0:_.player1Faction)||JSON.parse(localStorage.getItem("player1Faction"))||{name:"Imperium",logo:""}),[c,u]=m.useState(((Y=x.state)==null?void 0:Y.player2Name)||localStorage.getItem("player2Name")||"Player 2"),[d,$]=m.useState(((K=x.state)==null?void 0:K.player2Faction)||JSON.parse(localStorage.getItem("player2Faction"))||{name:"Imperium",logo:""}),[C,w]=m.useState(h("units")||[]),[R,o]=m.useState(h("rosterText")||""),[r,a]=m.useState(h("commandPointsPlayer1")||0),[T,D]=m.useState(h("commandPointsPlayer2")||0),[p,v]=m.useState(h("roundPointsPlayer1")||Array(5).fill(0)),[F,B]=m.useState(h("roundPointsPlayer2")||Array(5).fill(0)),[P,k]=m.useState(h("paintedBonusPlayer1")||!1),[t,S]=m.useState(h("paintedBonusPlayer2")||!1),[N,U]=m.useState(h("gameDate")||new Date().toISOString().split("T")[0]),[A,V]=m.useState(h("customFileName")||""),[E,z]=m.useState(["roster","cp","vp"]);m.useEffect(()=>{localStorage.setItem("player1Name",i),localStorage.setItem("player2Name",c),localStorage.setItem("player1Faction",JSON.stringify(g)),localStorage.setItem("player2Faction",JSON.stringify(d)),y("units",C),y("rosterText",R),y("commandPointsPlayer1",r),y("commandPointsPlayer2",T),y("roundPointsPlayer1",p),y("roundPointsPlayer2",F),y("paintedBonusPlayer1",P),y("paintedBonusPlayer2",t),y("gameDate",N),y("customFileName",A)},[i,c,g,d,C,R,r,T,p,F,P,t,N,A]);const ee=(s,b,se)=>{w(ne=>ne.map(H=>H.id===s?{...H,[b]:se}:H))},te=()=>{console.log("Parsing roster text:",R);try{const s=ye(R);console.log("Parsed units:",s),w(s)}catch(s){console.error("Error parsing roster:",s),alert("Error parsing roster. Please check the console for details.")}},oe=()=>{l("/",{state:{playerMode:"2"}})},J=()=>{window.confirm("Are you sure you want to reset all data?")&&Pe({setUnits:w,setRosterText:o,setCommandPointsPlayer1:a,setCommandPointsPlayer2:D,setRoundPointsPlayer1:v,setRoundPointsPlayer2:B,setPaintedBonusPlayer1:k,setPaintedBonusPlayer2:S,setGameDate:U,setCustomFileName:V,setPlayer1Name:n,setPlayer2Name:u,setPlayer1Faction:j,setPlayer2Faction:$})},ae=()=>{Te({units:C,commandPointsPlayer1:r,commandPointsPlayer2:T,roundPointsPlayer1:p,roundPointsPlayer2:F,paintedBonusPlayer1:P,paintedBonusPlayer2:t,gameDate:N,customFileName:A,player1Name:i,player2Name:c,player1FactionLogo:g.logo,player2FactionLogo:d.logo})};return e.jsx(ce,{theme:Fe,children:e.jsxs(fe,{maxWidth:"md",sx:{paddingTop:{xs:"48px",sm:"64px"},paddingBottom:"20px",paddingLeft:{xs:"8px",sm:"24px"},paddingRight:{xs:"8px",sm:"24px"}},children:[e.jsx(je,{onExportPDF:ae,onNavigateHome:oe,onReset:J,context:"twoPlayer",currentPage:"App2Player"}),e.jsxs(f,{className:"scrollable-container",children:[e.jsxs(W,{expanded:E.includes("roster"),onChange:()=>z(s=>s.includes("roster")?s.filter(b=>b!=="roster"):[...s,"roster"]),children:[e.jsx(G,{expandIcon:e.jsx(L,{}),children:e.jsxs(I,{variant:"h6",children:[i,"'s Roster"]})}),e.jsxs(O,{children:[e.jsx(ge,{rosterText:R,setRosterText:o,gameDate:N,setGameDate:U,customFileName:A,setCustomFileName:V,parseRoster:te,resetData:J}),e.jsx(pe,{units:C,updateUnit:ee})]})]}),e.jsxs(W,{expanded:E.includes("cp"),onChange:()=>z(s=>s.includes("cp")?s.filter(b=>b!=="cp"):[...s,"cp"]),children:[e.jsx(G,{expandIcon:e.jsx(L,{}),"aria-controls":"cp-content",id:"cp-header",children:e.jsx(I,{variant:"h6",children:"Command Points"})}),e.jsx(O,{children:e.jsxs(f,{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"center",marginBottom:2,children:[e.jsxs(f,{sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",padding:"10px",display:"flex",alignItems:"center",mb:{xs:2,sm:0}},children:[g.logo&&e.jsx("img",{src:g.logo,alt:`${g.name} logo`,style:{height:"60px",maxWidth:"100%",objectFit:"contain",marginRight:"10px"}}),e.jsx(ue,{commandPoints:r,setCommandPoints:a,customHeading:`${i} - CP`})]}),e.jsxs(f,{sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",padding:"10px",display:"flex",alignItems:"center"},children:[e.jsx(Ce,{commandPoints:T,setCommandPoints:D,customHeading:`${c} - CP`}),d.logo&&e.jsx("img",{src:d.logo,alt:`${d.name} logo`,style:{height:"60px",maxWidth:"100%",objectFit:"contain",marginLeft:"10px"}})]})]})})]}),e.jsxs(W,{expanded:E.includes("vp"),onChange:()=>z(s=>s.includes("vp")?s.filter(b=>b!=="vp"):[...s,"vp"]),children:[e.jsx(G,{expandIcon:e.jsx(L,{}),"aria-controls":"vp-content",id:"vp-header",children:e.jsx(I,{variant:"h6",children:"Victory Points"})}),e.jsxs(O,{children:[e.jsx(he,{roundPoints:p,setRoundPoints:v,paintedBonus:P,setPaintedBonus:k,customHeading:`${i} - VP`}),e.jsx(Re,{roundPoints:F,setRoundPoints:B,paintedBonus:t,setPaintedBonus:S,customHeading:`${c} - VP`})]})]}),e.jsxs(I,{variant:"h6",align:"center",className:"total-score",gutterBottom:!0,children:["Total Score ",i,": ",X(p,P)]}),e.jsxs(I,{variant:"h6",align:"center",className:"total-score",gutterBottom:!0,children:["Total Score ",c,": ",X(F,t)]})]})]})})};export{ve as default};
